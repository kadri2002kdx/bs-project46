<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>التواصل والدعم | EcoPlant DZ</title>
    
    <!-- المكتبات الأساسية -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    
    <style>
        :root {
            --success: #4caf50;
            --success: #4caf50;
            --primary: #2e7d32;
            --primary-dark: #1b5e20;
            --primary-light: #4caf50;
            --secondary: #8bc34a;
            --accent: #ffc107;
            --light: #f5f7fa;
            --dark: #212529;
            --gray: #6c757d;
            --dark-bg: #0d1b0e;
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Cairo', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--dark-bg);
            color: white;
            line-height: 1.6;
            min-height: 100vh;
        }
        
        /* شريط التنقل */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            background: rgba(13, 27, 14, 0.95);
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.2);
            transition: var(--transition);
            padding: 15px 0;
        }
        
        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-light);
            text-decoration: none;
        }
        
        .logo i {
            font-size: 1.5em;
            color: var(--accent);
        }
        
        .nav-links {
            display: flex;
            gap: 28px;
        }
        
        .nav-links a {
            font-weight: 600;
            position: relative;
            padding: 8px 0;
            color: white;
            text-decoration: none;
            transition: var(--transition);
        }
        
        .nav-links a::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 3px;
            background: var(--primary);
            border-radius: 3px;
            transition: var(--transition);
        }
        
        .nav-links a:hover::after,
        .nav-links a.active::after {
            width: 100%;
        }
        
        .nav-links a:hover,
        .nav-links a.active {
            color: var(--primary-light);
        }
        
        .nav-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .notification-icon, .messages-icon {
            position: relative;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .notification-icon:hover, .messages-icon:hover {
            color: var(--primary-light);
        }
        
        .badge {
            position: absolute;
            top: -8px;
            left: -8px;
            background: var(--accent);
            color: var(--dark);
            font-size: 0.7rem;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .user-menu {
            position: relative;
        }
        
        .user-btn {
            display: flex;
            align-items: center;
            gap: 10px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: white;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: var(--transition);
            border: 2px solid transparent;
        }
        
        .user-avatar:hover {
            border-color: var(--accent);
            transform: scale(1.05);
        }
        
        .user-avatar img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }
        
        .dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            background: var(--dark-bg);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            padding: 10px 0;
            min-width: 200px;
            display: none;
            z-index: 1000;
            border: 1px solid var(--primary-dark);
        }
        
        .dropdown-menu.show {
            display: block;
        }
        
        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            color: white;
            text-decoration: none;
            transition: var(--transition);
        }
        
        .dropdown-item:hover {
            background: rgba(46, 125, 50, 0.2);
            color: var(--primary-light);
        }
        
        /* محتوى التواصل */
        .contact-container {
            max-width: 1200px;
            margin: 100px auto 30px;
            padding: 20px;
        }
        
        .page-header {
            text-align: center;
            margin-bottom: 50px;
        }
        
        .page-title {
            font-size: 2.5rem;
            color: var(--primary-light);
            margin-bottom: 15px;
        }
        
        .page-subtitle {
            font-size: 1.2rem;
            color: var(--gray);
            max-width: 700px;
            margin: 0 auto;
        }
        
        .contact-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 60px;
        }
        
        @media (max-width: 768px) {
            .contact-content {
                grid-template-columns: 1fr;
            }
        }
        
        .contact-info {
            background: rgba(13, 27, 14, 0.8);
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 30px;
            border: 1px solid var(--primary-dark);
        }
        
        .contact-info h2 {
            color: var(--primary-light);
            margin-bottom: 25px;
            font-size: 1.8rem;
        }
        
        .contact-item {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .contact-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(46, 125, 50, 0.2);
            color: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }
        
        .contact-details h3 {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }
        
        .contact-details p {
            color: var(--gray);
        }
        
        .contact-form {
            background: rgba(13, 27, 14, 0.8);
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 30px;
            border: 1px solid var(--primary-dark);
        }
        
        .contact-form h2 {
            color: var(--primary-light);
            margin-bottom: 25px;
            font-size: 1.8rem;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid var(--primary-dark);
            background: rgba(255, 255, 255, 0.05);
            color: white;
            transition: var(--transition);
            font-family: 'Cairo', sans-serif;
        }
        
        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(46, 125, 50, 0.3);
        }
        
        .form-textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 30px;
        }
        
        .btn {
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            border: none;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: var(--primary-dark);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .faq-section {
            margin-top: 60px;
        }
        
        .section-title {
            text-align: center;
            font-size: 2rem;
            color: var(--primary-light);
            margin-bottom: 40px;
        }
        
        .faq-list {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .faq-item {
            background: rgba(13, 27, 14, 0.8);
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            border: 1px solid var(--primary-dark);
            overflow: hidden;
        }
        
        .faq-question {
            padding: 20px 25px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
        }
        
        .faq-question:hover {
            background: rgba(46, 125, 50, 0.1);
        }
        
        .faq-question h3 {
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .faq-icon {
            font-size: 1.2rem;
            color: var(--primary-light);
            transition: var(--transition);
        }
        
        .faq-item.active .faq-icon {
            transform: rotate(180deg);
        }
        
        .faq-answer {
            padding: 0 25px;
            max-height: 0;
            overflow: hidden;
            transition: var(--transition);
        }
        
        .faq-item.active .faq-answer {
            padding: 0 25px 20px;
            max-height: 500px;
        }
        
        .faq-answer p {
            color: var(--gray);
            line-height: 1.8;
        }
        
        .social-section {
            text-align: center;
            margin-top: 60px;
            padding: 40px 20px;
            background: rgba(13, 27, 14, 0.8);
            border-radius: 15px;
            border: 1px solid var(--primary-dark);
        }
        
        .social-title {
            font-size: 1.8rem;
            color: var(--primary-light);
            margin-bottom: 25px;
        }
        
        .social-links {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .social-link {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(46, 125, 50, 0.2);
            color: var(--primary-light);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: var(--transition);
            text-decoration: none;
        }
        
        .social-link:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-5px);
        }
        
        /* التكيف مع الشاشات الصغيرة */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            
            .contact-container {
                margin-top: 80px;
                padding: 15px;
            }
            
            .page-title {
                font-size: 2rem;
            }
            
            .contact-info,
            .contact-form {
                padding: 20px;
            }
            
            .contact-info h2,
            .contact-form h2 {
                font-size: 1.5rem;
            }
        }
        
        /* النوافذ المنبثقة */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            overflow-y: auto;
        }
        
        .modal-content {
            background-color: var(--dark-bg);
            margin: 10% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            position: relative;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.3);
            animation: modalopen 0.4s;
            border: 1px solid var(--primary-dark);
        }
        
        @keyframes modalopen {
            from {opacity: 0; transform: translateY(-50px);}
            to {opacity: 1; transform: translateY(0);}
        }
        
        .close {
            color: #aaa;
            float: left;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            left: 20px;
            top: 15px;
        }
        
        .close:hover {
            color: var(--primary-light);
        }
        
        .modal h2 {
            color: var(--primary-light);
            margin-bottom: 20px;
            padding-right: 30px;
        }
        
        /* رسائل التحميل */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(46, 125, 50, 0.1);
            border-left-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* تنبيهات */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--primary);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 3000;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .notification.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .notification.error {
            background: #f44336;
        }
        
        .notification.success {
            background: var(--primary);
        }
    </style>
</head>
<body>
    <!-- شريط التنقل -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="logo">
                <i class="fas fa-seedling"></i>
                <span>EcoPlant DZ</span>
            </a>
            
            <div class="nav-links">
                <a href="index.html">الرئيسية</a>
                <a href="dashboard.html">لوحة التحكم</a>
                <a href="questions.html">الأسئلة</a>
                <a href="messages.html">الرسائل</a>
                <a href="about.html">من نحن</a>
                <a href="contact.html" class="active">التواصل و الدعم</a>
            </div>
            
            <div class="nav-actions">
                <div class="notification-icon" onclick="openModal('notificationsModal')">
                    <i class="fas fa-bell"></i>
                    <span class="badge" id="notificationCount">0</span>
                </div>
                
                <div class="messages-icon" onclick="window.location.href='messages.html'">
                    <i class="fas fa-envelope"></i>
                    <span class="badge" id="messageCount">0</span>
                </div>
                
                <div class="user-menu">
                    <button class="user-btn">
                        <div class="user-avatar" id="navAvatar">م</div>
                        <span id="navUserName">مستخدم</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    
                    <div class="dropdown-menu" id="userDropdown">
                        <a href="dashboard.html" class="dropdown-item">
                            <i class="fas fa-tachometer-alt"></i>
                            <span>لوحة التحكم</span>
                        </a>
                        <a href="profile.html" class="dropdown-item">
                            <i class="fas fa-user"></i>
                            <span>الملف الشخصي</span>
                        </a>
                        <a href="settings.html" class="dropdown-item">
                            <i class="fas fa-cog"></i>
                            <span>الإعدادات</span>
                        </a>
                        <a href="#" class="dropdown-item" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>تسجيل الخروج</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    
    <!-- محتوى التواصل -->
    <div class="contact-container">
        <div class="page-header">
            <h1 class="page-title">التواصل والدعم</h1>
            <p class="page-subtitle">نحن هنا لمساعدتك. تواصل معنا لأي استفسار أو اقتراح</p>
        </div>
        
        <div class="contact-content">
            <div class="contact-info">
                <h2>معلومات التواصل</h2>
                
                <div class="contact-item">
                    <div class="contact-icon">
                        <i class="fas fa-map-marker-alt"></i>
                    </div>
                    <div class="contact-details">
                        <h3>العنوان</h3>
                        <p>جامعة حمه لخضر بالوادي</p>
                    </div>
                </div>
                
                <div class="contact-item">
                    <div class="contact-icon">
                        <i class="fas fa-phone"></i>
                    </div>
                    <div class="contact-details">
                        <h3>الهاتف</h3>
                        <p>+213 06 68 84 08 61 </p>
                    </div>
                </div>
                
                <div class="contact-item">
                    <div class="contact-icon">
                        <i class="fas fa-envelope"></i>
                    </div>
                    <div class="contact-details">
                        <h3>البريد الإلكتروني</h3>
                        <p>support@ecoplant-dz.com</p>
                    </div>
                </div>
                
                <div class="contact-item">
                    <div class="contact-icon">
                        <i class="fas fa-clock"></i>
                    </div>
                    <div class="contact-details">
                        <h3>ساعات العمل</h3>
                        <p>الأحد - الخميس: 9:00 ص - 5:00 م</p>
                        <p>الجمعة: 9:00 ص - 12:00 م</p>
                    </div>
                </div>
            </div>
            
            <div class="contact-form">
                <h2>أرسل لنا رسالة</h2>
                
                <form id="contactForm">
                    <div class="form-group">
                        <label class="form-label" for="contactName">الاسم الكامل</label>
                        <input type="text" class="form-input" id="contactName" placeholder="أدخل اسمك الكامل" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="contactEmail">البريد الإلكتروني</label>
                        <input type="email" class="form-input" id="contactEmail" placeholder="أدخل بريدك الإلكتروني" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="contactSubject">الموضوع</label>
                        <select class="form-select" id="contactSubject" required>
                            <option value="">اختر الموضوع</option>
                            <option value="support">دعم فني</option>
                            <option value="feedback">اقتراحات</option>
                            <option value="partnership">شراكة</option>
                            <option value="other">أخرى</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="contactMessage">الرسالة</label>
                        <textarea class="form-textarea" id="contactMessage" placeholder="اكتب رسالتك هنا..." required></textarea>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="resetForm()">إعادة تعيين</button>
                        <button type="submit" class="btn btn-primary">إرسال الرسالة</button>
                    </div>
                </form>
            </div>
        </div>
        
        <div class="faq-section">
            <h2 class="section-title">الأسئلة الشائعة</h2>
            
            <div class="faq-list">
                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFAQ(this)">
                        <h3>كيف يمكنني الانضمام إلى مجتمع EcoPlant DZ؟</h3>
                        <i class="fas fa-chevron-down faq-icon"></i>
                    </div>
                    <div class="faq-answer">
                        <p>يمكنك الانضمام إلى مجتمعنا بسهولة من خلال إنشاء حساب على منصتنا. كل ما عليك فعله هو النقر على زر "تسجيل" في أعلى الصفحة وملء البيانات المطلوبة. بعد التسجيل، يمكنك المشاركة في المناقشات وطرح الأسئلة ومشاركة معرفتك مع الآخرين.</p>
                    </div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFAQ(this)">
                        <h3>ما هي فوائد الانضمام إلى EcoPlant DZ؟</h3>
                        <i class="fas fa-chevron-down faq-icon"></i>
                    </div>
                    <div class="faq-answer">
                        <p>الانضمام إلى EcoPlant DZ يوفر لك العديد من الفوائد بما في ذلك: الوصول إلى شبكة من الخبراء في مجال الزراعة والبيئة، المشاركة في المشاريع البيئية، الحصول على نقاط Eco للمشاركة الفعالة، فرص التعلم والتطوير، والمساهمة في بناء مستقبل أكثر استدامة للجزائر.</p>
                    </div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFAQ(this)">
                        <h3>كيف يمكنني كسب نقاط Eco؟</h3>
                        <i class="fas fa-chevron-down faq-icon"></i>
                    </div>
                    <div class="faq-answer">
                        <p>يمكنك كسب نقاط Eco من خلال عدة طرق: المشاركة في المناقشات، الإجابة على الأسئلة، نشر محتوى مفيد، المشاركة في الفعاليات، وإكمال المهام اليومية. كل نقطة Eco تعكس مساهمتك الإيجابية في المجتمع.</p>
                    </div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question" onclick="toggleFAQ(this)">
                        <h3>هل يمكنني المساهمة في المشاريع البيئية؟</h3>
                        <i class="fas fa-chevron-down faq-icon"></i>
                    </div>
                    <div class="faq-answer">
                        <p>نعم، بالتأكيد! نحن نشجع جميع الأعضاء على المساهمة في المشاريع البيئية. يمكنك المشاركة من خلال تقديم أفكار جديدة، الانضمام إلى الفرق العاملة على المشاريع الحالية، أو حتى قيادة مشروعك الخاص. تواصل معنا لمعرفة المزيد عن الفرص المتاحة.</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="social-section">
            <h2 class="social-title">تابعنا على وسائل التواصل الاجتماعي</h2>
            
            <div class="social-links">
                <a href="#" class="social-link">
                    <i class="fab fa-facebook-f"></i>
                </a>
                <a href="#" class="social-link">
                    <i class="fab fa-twitter"></i>
                </a>
                <a href="#" class="social-link">
                    <i class="fab fa-instagram"></i>
                </a>
                <a href="#" class="social-link">
                    <i class="fab fa-linkedin-in"></i>
                </a>
                <a href="#" class="social-link">
                    <i class="fab fa-youtube"></i>
                </a>
                <a href="#" class="social-link">
                    <i class="fab fa-telegram-plane"></i>
                </a>
            </div>
        </div>
    </div>
    
    <!-- نافذة الإشعارات -->
    <div id="notificationsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('notificationsModal')">&times;</span>
            <h2>الإشعارات</h2>
            <div id="notificationsList">
                <p>لا توجد إشعارات جديدة حالياً. ستحصل على إشعارات عندما:</p>
                <ul>
                    <li>يتم الرد على أسئلتك</li>
                    <li>يتم تقييم إجاباتك</li>
                    <li>تحصل على شارات جديدة</li>
                    <li>يتم إرسال رسالة جديدة لك</li>
                    <li>يتم نشر محتوى جديد يهمك</li>
                </ul>
            </div>
        </div>
    </div>
    
    <!-- نافذة التحميل -->
    <div id="loadingModal" class="modal" style="display: none; align-items: center; justify-content: center; background-color: rgba(0,0,0,0.5);">
        <div class="loading">
            <div class="loading-spinner"></div>
        </div>
    </div>
    
    <script>
        // إعداد Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCVELN-Jca7q3xtS0uWk2ZrNnlqXJzsKpg",
            authDomain: "ecoplant-dz-148bf.firebaseapp.com",
            databaseURL: "https://ecoplant-dz-148bf-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "ecoplant-dz-148bf",
            storageBucket: "ecoplant-dz-148bf.appspot.com",
            messagingSenderId: "233372376001",
            appId: "1:233372376001:web:2c261f4bf161a65f726d40",
            measurementId: "G-4PJZMLMKJE"
        };
        
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        
        const auth = firebase.auth();
        const db = firebase.database();
        const storage = firebase.storage();
        
        // متغيرات عامة
        let currentUser = null;
        let unreadNotificationsCount = 0;
        
        // تهيئة التطبيق
        document.addEventListener("DOMContentLoaded", () => {
            // مراقبة حالة المستخدم
            auth.onAuthStateChanged(async (user) => {
                if (!user) {
                    localStorage.clear();
                    window.location.href = "login.html";
                    return;
                }
                
                currentUser = user;
                
                // جلب بيانات المستخدم
                try {
                    const snapshot = await db.ref("users/" + user.uid).once("value");
                    const userData = snapshot.val() || {};
                    
                    // حفظ البيانات محلياً
                    localStorage.setItem("user", JSON.stringify(userData));
                    
                    // تحديث واجهة المستخدم
                    updateUserInterface(userData, user);
                    
                    // تحميل الإشعارات غير المقروءة
                    loadUnreadCounts();
                    
                } catch (error) {
                    console.error("فشل تحميل بيانات المستخدم:", error);
                    showNotification("فشل تحميل بيانات المستخدم", "error");
                }
            });
            
            // إعداد القائمة المنسدلة للمستخدم
            document.querySelector('.user-btn').addEventListener('click', function() {
                document.getElementById('userDropdown').classList.toggle('show');
            });
            
            // إغلاق القائمة المنسدلة عند النقر خارجها
            window.addEventListener('click', function(event) {
                if (!event.target.matches('.user-btn') && !event.target.closest('.user-btn')) {
                    const dropdown = document.getElementById('userDropdown');
                    if (dropdown.classList.contains('show')) {
                        dropdown.classList.remove('show');
                    }
                }
            });
            
            // إعداد زر تسجيل الخروج
            document.getElementById("logoutBtn").addEventListener("click", async () => {
                await auth.signOut();
                localStorage.clear();
                window.location.href = "login.html";
            });
            
            // إعداد نموذج التواصل
            const contactForm = document.getElementById("contactForm");
            if (contactForm) {
                contactForm.addEventListener("submit", async function(e) {
                    e.preventDefault();
                    
                    const name = document.getElementById("contactName").value.trim();
                    const email = document.getElementById("contactEmail").value.trim();
                    const subject = document.getElementById("contactSubject").value;
                    const message = document.getElementById("contactMessage").value.trim();
                    
                    if (!name || !email || !subject || !message) {
                        showNotification("يرجى ملء جميع الحقول", "error");
                        return;
                    }
                    
                    try {
                        showLoading();
                        
                        // حفظ الرسالة في قاعدة البيانات
                        const newMessageRef = db.ref("contactMessages").push();
                        await newMessageRef.set({
                            name: name,
                            email: email,
                            subject: subject,
                            message: message,
                            userId: currentUser ? currentUser.uid : null,
                            timestamp: Date.now(),
                            status: 'pending'
                        });
                        
                        // إعادة تعيين النموذج
                        resetForm();
                        
                        hideLoading();
                        showNotification("تم إرسال رسالتك بنجاح، سنتواصل معك قريباً", "success");
                        
                    } catch (error) {
                        console.error("خطأ في إرسال الرسالة:", error);
                        hideLoading();
                        showNotification("فشل في إرسال الرسالة", "error");
                    }
                });
            }
        });
        
        // تحديث واجهة المستخدم
        function updateUserInterface(userData, user) {
            // تحديث شريط التنقل
            safeSetText("navUserName", `${userData.firstName || ""} ${userData.lastName || ""}`);
            
            // تحديث الصورة الرمزية
            const avatarUrl = user.photoURL || userData.photoURL;
            if (avatarUrl) {
                safeSetHTML("navAvatar", `<img src="${avatarUrl}" alt="">`);
            } else {
                const letter = (userData.firstName?.[0] || user.displayName?.[0] || "م").toUpperCase();
                safeSetText("navAvatar", letter);
            }
        }
        
        // تبديل عرض إجابة السؤال الشائع
        function toggleFAQ(element) {
            const faqItem = element.parentElement;
            const allFaqItems = document.querySelectorAll('.faq-item');
            
            // إغلاق جميع العناصر الأخرى
            allFaqItems.forEach(item => {
                if (item !== faqItem) {
                    item.classList.remove('active');
                }
            });
            
            // تبديل العنصر الحالي
            faqItem.classList.toggle('active');
        }
        
        // إعادة تعيين نموذج التواصل
        function resetForm() {
            document.getElementById("contactForm").reset();
        }
        
        // تحميل عدد الإشعارات غير المقروءة
        async function loadUnreadCounts() {
            try {
                // تحميل عدد الإشعارات غير المقروءة
                const notificationsSnapshot = await db.ref("notifications/" + currentUser.uid)
                    .orderByChild("timestamp")
                    .once("value");
                
                unreadNotificationsCount = 0;
                
                if (notificationsSnapshot.exists()) {
                    notificationsSnapshot.forEach((childSnapshot) => {
                        const notification = childSnapshot.val();
                        if (!notification.read) {
                            unreadNotificationsCount++;
                        }
                    });
                }
                
                // تحديث العداد في واجهة المستخدم
                const badge = document.getElementById("notificationCount");
                if (badge) {
                    if (unreadNotificationsCount > 0) {
                        badge.textContent = unreadNotificationsCount > 99 ? "99+" : unreadNotificationsCount;
                        badge.style.display = "flex";
                    } else {
                        badge.style.display = "none";
                    }
                }
                
            } catch (error) {
                console.error("خطأ في تحميل عدد الإشعارات غير المقروءة:", error);
            }
        }
        
        // أدوات مساعدة
        function safeSetText(id, text) {
            const el = document.getElementById(id);
            if (el) el.textContent = text;
        }
        
        function safeSetHTML(id, html) {
            const el = document.getElementById(id);
            if (el) el.innerHTML = html;
        }
        
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
            document.body.style.overflow = 'hidden';
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'error' ? 'exclamation-circle' : (type === 'success' ? 'check-circle' : 'info-circle')}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            // إظهار الإشعار
            setTimeout(() => notification.classList.add('show'), 10);
            
            // إخفاء الإشعار بعد 3 ثوان
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        function showLoading() {
            document.getElementById('loadingModal').style.display = 'flex';
        }
        
        function hideLoading() {
            document.getElementById('loadingModal').style.display = 'none';
        }
        
        // إغلاق النوافذ المنبثقة بالنقر خارجها
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
                document.body.style.overflow = 'auto';
            }
        }
    </script>
</body>
</html>